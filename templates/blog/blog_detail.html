{% extends 'base.html' %}
{% load blog_tags %}

{% block title %}{{ post.meta_title|default:post.title }}{% endblock %}
{% block meta_description %}{{ post.meta_description|default:post.summary }}{% endblock %}

{% block extra_head %}
<style>
    /* Blog Typography Styling */
    .blog-content {
        font-family: 'Outfit', sans-serif;
        color: #334155;
        line-height: 1.8;
    }
    .blog-content h2 {
        font-size: 2rem;
        font-weight: 800;
        color: #1e293b;
        margin-top: 3rem;
        margin-bottom: 1.5rem;
        letter-spacing: -0.02em;
    }
    .blog-content h3 {
        font-size: 1.5rem;
        font-weight: 700;
        color: #1e293b;
        margin-top: 2.5rem;
        margin-bottom: 1rem;
    }
    .blog-content p {
        margin-bottom: 1.5rem;
        font-size: 1.125rem;
    }
    .blog-content ul, .blog-content ol {
        margin-bottom: 2rem;
        padding-left: 1.5rem;
        list-style-type: disc;
    }
    .blog-content li {
        margin-bottom: 0.75rem;
    }
    .blog-content blockquote {
        border-left: 4px solid #818cf8;
        padding-left: 2rem;
        margin: 2.5rem 0;
        font-style: italic;
        font-size: 1.25rem;
        color: #475569;
        background: #f8fafc;
        padding: 2rem;
        border-radius: 0 1rem 1rem 0;
    }
    .blog-content img {
        border-radius: 1.5rem;
        margin: 2.5rem 0;
        box-shadow: 0 20px 40px -10px rgba(0,0,0,0.1);
    }
    
    /* Sticky TOC styling */
    .toc-sticky {
        position: sticky;
        top: 120px;
    }
    
    /* Progress Bar */
    .progress-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 4px;
        z-index: 100;
    }
    .progress-bar {
        height: 100%;
        background: linear-gradient(90deg, #818cf8, #c084fc);
        width: 0%;
        transition: width 0.1s;
    }
</style>
{% endblock %}

{% block content %}
<!-- Reading Progress Bar -->
<div class="progress-container">
    <div class="progress-bar" id="progressBar"></div>
</div>

<!-- Article Header -->
<article class="relative pt-32 pb-12 lg:pt-48">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
        
        <!-- Back Link -->
        <div class="mb-8 reveal-up">
            <a href="{% url 'blog_list' %}" class="inline-flex items-center text-sm font-bold text-indigo-600 hover:text-purple-600 bg-indigo-50 px-4 py-2 rounded-full transition-colors">
                <i data-lucide="arrow-left" class="w-4 h-4 mr-2"></i> Back to Blog
            </a>
        </div>
        
        <!-- Meta Info -->
        <div class="flex flex-wrap items-center justify-center gap-4 mb-8 text-sm text-slate-500 reveal-up stagger-1">
            <span class="px-3 py-1 bg-indigo-100 text-indigo-700 font-bold rounded-full uppercase tracking-wider text-xs">{{ post.category.name }}</span>
            <span class="flex items-center gap-1"><i data-lucide="calendar" class="w-4 h-4"></i> {{ post.published_at|date:"F d, Y"|default:post.created_at|date:"F d, Y" }}</span>
            <span class="flex items-center gap-1"><i data-lucide="clock" class="w-4 h-4"></i> {{ post.reading_time|default:post.content|reading_time }} min read</span>
        </div>
        
        <!-- Title -->
        <h1 class="text-4xl md:text-6xl font-extrabold text-slate-900 tracking-tight mb-8 leading-tight reveal-up stagger-2">
            {{ post.title }}
        </h1>
        
        <!-- Subtitle/Summary -->
        <p class="text-xl text-slate-600 leading-relaxed mb-12 reveal-up stagger-3">
            {{ post.summary }}
        </p>
        
        <!-- Author -->
        <div class="flex items-center justify-center gap-4 reveal-up stagger-3">
            <div class="w-12 h-12 rounded-full bg-indigo-100 overflow-hidden border-2 border-white shadow-md">
                {% if post.author_image %}
                <img src="{{ post.author_image.url }}" alt="Author" class="w-full h-full object-cover">
                {% else %}
                <img src="https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?auto=format&fit=crop&w=100&q=80" alt="Author" class="w-full h-full object-cover">
                {% endif %}
            </div>
            <div class="text-left">
                <div class="font-bold text-slate-900">{{ post.author.get_full_name|default:post.author.username }}</div>
                <div class="text-xs text-slate-500">Tech Contributor</div>
            </div>
        </div>
    </div>
</article>

<!-- Featured Image -->
<div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 mb-20 reveal-zoom">
    <div class="rounded-[2.5rem] overflow-hidden shadow-2xl">
        {% if post.featured_image %}
        <img src="{{ post.featured_image.url }}" alt="{{ post.title }}" class="w-full h-[500px] object-cover">
        {% else %}
        <img src="https://images.unsplash.com/photo-1516321318423-f06f85e504b3?auto=format&fit=crop&w=2070&q=80" alt="{{ post.title }}" class="w-full h-[500px] object-cover">
        {% endif %}
    </div>
</div>

<!-- Main Content Area -->
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-24">
    <div class="grid grid-cols-1 lg:grid-cols-12 gap-12">
        
        <!-- Sidebar / TOC -->
        <div class="hidden lg:block lg:col-span-3">
            <div class="toc-sticky">
                <div class="glass-card p-6 rounded-2xl">
                    <h3 class="text-sm font-bold text-slate-900 uppercase tracking-wider mb-4">Table of Contents</h3>
                    <nav class="space-y-3 text-sm">
                         {% if post.blog_sections.all %}
                            {% for section in post.blog_sections.all %}
                                {% if section.section_type == 'heading' and section.heading %}
                                <a href="#section-{{ section.order }}" class="block text-slate-500 hover:text-indigo-600 transition-colors pl-3 border-l-2 border-transparent hover:border-indigo-600">
                                    {{ section.heading }}
                                </a>
                                {% endif %}
                            {% endfor %}
                        {% endif %}
                        <!-- Fallback dummy links if no sections -->
                         <a href="#" class="block text-slate-500 hover:text-indigo-600 transition-colors pl-3 border-l-2 border-transparent hover:border-indigo-600">Introduction</a>
                         <a href="#" class="block text-slate-500 hover:text-indigo-600 transition-colors pl-3 border-l-2 border-transparent hover:border-indigo-600">Key Concepts</a>
                         <a href="#" class="block text-slate-500 hover:text-indigo-600 transition-colors pl-3 border-l-2 border-transparent hover:border-indigo-600">Conclusion</a>
                    </nav>
                    
                    <!-- Share Icons -->
                    <div class="mt-8 pt-6 border-t border-slate-200">
                        <p class="text-xs font-bold text-slate-400 mb-3">SHARE</p>
                        <div class="flex gap-3">
                            <button class="p-2 bg-slate-100 rounded-full hover:bg-indigo-100 hover:text-indigo-600 transition-colors"><i data-lucide="twitter" class="w-4 h-4"></i></button>
                            <button class="p-2 bg-slate-100 rounded-full hover:bg-indigo-100 hover:text-indigo-600 transition-colors"><i data-lucide="linkedin" class="w-4 h-4"></i></button>
                            <button class="p-2 bg-slate-100 rounded-full hover:bg-indigo-100 hover:text-indigo-600 transition-colors"><i data-lucide="facebook" class="w-4 h-4"></i></button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Content Body -->
        <div class="col-span-1 lg:col-span-8 lg:col-start-4">
            <div class="blog-content animate-on-scroll">
                {% if post.content %}
                    <div class="mb-12">
                        {{ post.content|markdown }}
                    </div>
                {% endif %}

                <!-- Dynamic Blog Sections -->
                {% if post.blog_sections.all %}
                    {% for section in post.blog_sections.all %}
                        {% render_section section %}
                    {% endfor %}
                {% endif %}
                
                <!-- Placeholder Content if empty -->
                 {% if not post.content and not post.blog_sections.all %}
                    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
                    <h2>The Future of Tech</h2>
                    <p>Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
                    <blockquote>"Technology is best when it brings people together." - Matt Mullenweg</blockquote>
                    <p>Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae dicta sunt explicabo.</p>
                 {% endif %}
            </div>
            
            <!-- Tags -->
             {% if post.get_tag_list %}
            <div class="mt-12 pt-8 border-t border-slate-200">
                <div class="flex flex-wrap gap-2">
                    {% for tag in post.get_tag_list %}
                    <span class="px-4 py-2 bg-slate-100 text-slate-600 rounded-lg text-sm font-medium hover:bg-indigo-50 hover:text-indigo-600 transition-colors cursor-pointer">#{{ tag }}</span>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
        </div>
        
    </div>
</div>

<!-- Related Articles -->
<section class="py-20 bg-slate-50 border-t border-slate-200">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-end mb-12">
            <div>
                <h2 class="text-3xl font-bold text-slate-900">Read Next</h2>
                <p class="text-slate-500 mt-2">More insights you might find interesting</p>
            </div>
            <a href="{% url 'blog_list' %}" class="hidden md:flex items-center font-bold text-indigo-600 hover:text-purple-600 transition-colors">
                View All <i data-lucide="arrow-right" class="w-4 h-4 ml-2"></i>
            </a>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
             <!-- Mock/Real Related Posts -->
             {% if related_posts %}
                {% for related in related_posts %}
                 <a href="{% url 'blog_detail' related.slug %}" class="group block">
                    <div class="rounded-2xl overflow-hidden mb-4 shadow-sm group-hover:shadow-lg transition-all duration-300">
                        {% if related.featured_image %}
                        <img src="{{ related.featured_image.url }}" class="w-full h-48 object-cover group-hover:scale-105 transition-transform duration-500">
                        {% else %}
                        <img src="https://images.unsplash.com/photo-1516321318423-f06f85e504b3?auto=format&fit=crop&w=800&q=80" class="w-full h-48 object-cover group-hover:scale-105 transition-transform duration-500">
                        {% endif %}
                    </div>
                    <h3 class="text-xl font-bold text-slate-900 group-hover:text-indigo-600 transition-colors mb-2">{{ related.title }}</h3>
                    <div class="text-sm text-slate-500">{{ related.published_at|date:"M d, Y" }}</div>
                </a>
                {% endfor %}
             {% else %}
                <!-- Fallback Mocks -->
                <div class="group cursor-pointer">
                    <div class="rounded-2xl overflow-hidden mb-4 shadow-sm group-hover:shadow-lg transition-all duration-300">
                        <img src="https://images.unsplash.com/photo-1550751827-4bd374c3f58b?auto=format&fit=crop&w=800&q=80" class="w-full h-48 object-cover group-hover:scale-105 transition-transform duration-500">
                    </div>
                    <h3 class="text-xl font-bold text-slate-900 group-hover:text-indigo-600 transition-colors mb-2">The Future of AI in Web Development</h3>
                    <div class="text-sm text-slate-500">Oct 24, 2025</div>
                </div>
                <div class="group cursor-pointer">
                    <div class="rounded-2xl overflow-hidden mb-4 shadow-sm group-hover:shadow-lg transition-all duration-300">
                        <img src="https://images.unsplash.com/photo-1460925895917-afdab827c52f?auto=format&fit=crop&w=800&q=80" class="w-full h-48 object-cover group-hover:scale-105 transition-transform duration-500">
                    </div>
                    <h3 class="text-xl font-bold text-slate-900 group-hover:text-indigo-600 transition-colors mb-2">Scaling Your SaaS Product</h3>
                    <div class="text-sm text-slate-500">Oct 10, 2025</div>
                </div>
                <div class="group cursor-pointer">
                    <div class="rounded-2xl overflow-hidden mb-4 shadow-sm group-hover:shadow-lg transition-all duration-300">
                        <img src="https://images.unsplash.com/photo-1451187580459-43490279c0fa?auto=format&fit=crop&w=800&q=80" class="w-full h-48 object-cover group-hover:scale-105 transition-transform duration-500">
                    </div>
                    <h3 class="text-xl font-bold text-slate-900 group-hover:text-indigo-600 transition-colors mb-2">Cybersecurity Best Practices</h3>
                    <div class="text-sm text-slate-500">Sep 28, 2025</div>
                </div>
             {% endif %}
        </div>
    </div>
</section>

{% endblock %}

{% block extra_js %}
<script>
    // Scroll Progress Bar
    window.addEventListener('scroll', () => {
        const winScroll = document.body.scrollTop || document.documentElement.scrollTop;
        const height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
        const scrolled = (winScroll / height) * 100;
        document.getElementById("progressBar").style.width = scrolled + "%";
    });

    // Smooth scroll for TOC
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            document.querySelector(this.getAttribute('href')).scrollIntoView({
                behavior: 'smooth'
            });
        });
    });
</script>
{% endblock %}